{"version":3,"sources":["./src/app/pagetwo/pagetwo.page.html","./src/app/pagetwo/pagetwo-routing.module.ts","./src/app/pagetwo/pagetwo.module.ts","./src/app/pagetwo/pagetwo.page.scss","./src/app/pagetwo/pagetwo.page.ts","./src/app/services/servicetwo.service.ts"],"names":[],"mappings":"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","file":"pagetwo-pagetwo-module-es2015.js","sourcesContent":["export default \"<ion-header>\\r\\n  <ion-toolbar>\\r\\n    <ion-title>Pagina de productos</ion-title>\\r\\n  </ion-toolbar>\\r\\n</ion-header>\\r\\n\\r\\n<ion-content>\\r\\n  <ion-card>\\r\\n    <ion-card-header>\\r\\n      <ion-card-title>Productos</ion-card-title>\\r\\n    </ion-card-header>\\r\\n  \\r\\n    <ion-card-content>\\r\\n      Agrega y elimina productos de tu lista\\r\\n    </ion-card-content>\\r\\n  </ion-card>\\r\\n  \\r\\n  <ion-card>\\r\\n\\r\\n\\r\\n \\r\\n    <ion-card>\\r\\n      <ion-card-content>\\r\\n        <ion-item-sliding *ngFor=\\\"let p of products\\\">\\r\\n          <ion-item [routerLink]=\\\"['product', p.id]\\\">\\r\\n            <ion-label>\\r\\n              {{ p.name }}\\r\\n              <p>{{ p.value | currency:p.currency }}</p>\\r\\n            </ion-label>\\r\\n          </ion-item>\\r\\n          \\r\\n        </ion-item-sliding>\\r\\n      </ion-card-content>\\r\\n   \\r\\n    </ion-card>\\r\\n   \\r\\n  \\r\\n  </ion-card>\\r\\n\\r\\n  <ion-button expand=\\\"full\\\" (click)=\\\"addProduct()\\\">Agregar producto</ion-button>\\r\\n\\r\\n\\r\\n  <ion-button expand=\\\"full\\\" routerLink=\\\"/\\\" >Regresar</ion-button>\\r\\n\\r\\n</ion-content>\\r\\n\";","import { NgModule } from '@angular/core';\r\nimport { Routes, RouterModule } from '@angular/router';\r\n\r\nimport { PagetwoPage } from './pagetwo.page';\r\n\r\nconst routes: Routes = [\r\n  {\r\n    path: '',\r\n    component: PagetwoPage\r\n  }\r\n];\r\n\r\n@NgModule({\r\n  imports: [RouterModule.forChild(routes)],\r\n  exports: [RouterModule],\r\n})\r\nexport class PagetwoPageRoutingModule {}\r\n","import { NgModule } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\nimport { FormsModule } from '@angular/forms';\r\n\r\nimport { IonicModule } from '@ionic/angular';\r\n\r\nimport { PagetwoPageRoutingModule } from './pagetwo-routing.module';\r\n\r\nimport { PagetwoPage } from './pagetwo.page';\r\n\r\n@NgModule({\r\n  imports: [\r\n    CommonModule,\r\n    FormsModule,\r\n    IonicModule,\r\n    PagetwoPageRoutingModule\r\n  ],\r\n  declarations: [PagetwoPage]\r\n})\r\nexport class PagetwoPageModule {}\r\n","export default \"\\n/*# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IiIsImZpbGUiOiJzcmMvYXBwL3BhZ2V0d28vcGFnZXR3by5wYWdlLnNjc3MifQ== */\";","import { Component, OnInit } from '@angular/core';\r\nimport { ServicetwoService } from '../services/servicetwo.service';\r\n\r\n@Component({\r\n  selector: 'app-pagetwo',\r\n  templateUrl: './pagetwo.page.html',\r\n  styleUrls: ['./pagetwo.page.scss'],\r\n})\r\nexport class PagetwoPage {\r\n\r\n  products = [];\r\n  export = null;\r\n  newProduct = 'My cool product';\r\n\r\n  constructor(private databaseService: ServicetwoService) {\r\n    this.loadProducts();\r\n  }\r\n  \r\n  loadProducts() {\r\n    this.databaseService.getProductList().subscribe(res => {\r\n      this.products = res.values;\r\n      console.log('my products: ', res);\r\n    });\r\n  }\r\n\r\n  // Mode is either \"partial\" or \"full\"\r\n  async createExport(mode) {\r\n    const dataExport = await this.databaseService.getDatabaseExport(mode);\r\n    console.log('my export: ', dataExport);\r\n    \r\n    this.export = dataExport.export;\r\n  }\r\n \r\n  async addProduct() {\r\n    await this.databaseService.addDummyProduct(this.newProduct);\r\n    this.newProduct = '';\r\n    this.loadProducts();\r\n  }\r\n \r\n  async deleteProduct(product) {    \r\n    await this.databaseService.deleteProduct(product.id);\r\n    this.products = this.products.filter(p => p != product);    \r\n  }\r\n \r\n  \r\n}\r\n","import { Injectable } from '@angular/core';\r\nimport { Plugins } from '@capacitor/core';\r\nimport '@capacitor-community/sqlite';\r\nimport { JsonSQLite } from '@capacitor-community/sqlite';\r\nimport { BehaviorSubject, from, of } from 'rxjs';\r\nimport { HttpClient } from '@angular/common/http';\r\nimport { AlertController } from '@ionic/angular';\r\nimport { switchMap } from 'rxjs/operators';\r\nconst { CapacitorSQLite, Device, Storage } = Plugins;\r\nconst DB_SETUP_KEY = 'first_db_setup';\r\nconst DB_NAME_KEY = 'db_name';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class ServicetwoService {\r\n\r\n  dbReady = new BehaviorSubject(false);\r\n  dbName = '';\r\n\r\n  constructor(private http: HttpClient, private alertCtrl: AlertController) { }\r\n\r\n  async init() {\r\n    const info = await Device.getInfo();\r\n\r\n    if (info.platform === 'android') {\r\n      try {\r\n        const sqlite = CapacitorSQLite as any;\r\n        await sqlite.requestPermissions();\r\n        this.setupDatabase();\r\n      } catch (e) {\r\n        const alert = await this.alertCtrl.create({\r\n          header: 'No DB access',\r\n          message: 'This app can\\'t work without Database access.',\r\n          buttons: ['OK']\r\n        });\r\n        await alert.present();\r\n      }\r\n    } else {\r\n      this.setupDatabase();\r\n    }\r\n  }\r\n\r\n  private async setupDatabase() {\r\n    const dbSetupDone = await Storage.get({ key: DB_SETUP_KEY });\r\n\r\n    if (!dbSetupDone.value) {\r\n      this.downloadDatabase();\r\n    } else {\r\n      this.dbName = (await Storage.get({ key: DB_NAME_KEY })).value;\r\n      await CapacitorSQLite.open({ database: this.dbName });\r\n      this.dbReady.next(true);\r\n    }\r\n  }\r\n\r\n  // Potentially build this out to an update logic:\r\n  // Sync your data on every app start and update the device DB\r\n  private downloadDatabase(update = false) {\r\n    this.http.get('https://devdactic.fra1.digitaloceanspaces.com/tutorial/db.json')\r\n      .subscribe(async (jsonExport: JsonSQLite) => {\r\n        const jsonstring = JSON.stringify(jsonExport);\r\n        const isValid = await CapacitorSQLite.isJsonValid({ jsonstring });\r\n        console.log('import: ', jsonstring);\r\n        \r\n        if (isValid.result) {\r\n          this.dbName = jsonExport.database;\r\n          await Storage.set({ key: DB_NAME_KEY, value: this.dbName });\r\n          await CapacitorSQLite.importFromJson({ jsonstring });\r\n          await Storage.set({ key: DB_SETUP_KEY, value: '1' });\r\n\r\n          // Your potential logic to detect offline changes later\r\n          if (!update) {\r\n            await CapacitorSQLite.createSyncTable();\r\n          } else {\r\n            await CapacitorSQLite.setSyncDate({ syncdate: '' + new Date().getTime() })\r\n          }\r\n\r\n          this.dbReady.next(true);\r\n        }\r\n      });\r\n  }\r\n\r\n  getProductList() {\r\n    return this.dbReady.pipe(\r\n      switchMap(isReady => {\r\n        if (!isReady) {\r\n          return of({ values: [] });\r\n        } else {\r\n          const statement = 'SELECT * FROM products;';\r\n          return from(CapacitorSQLite.query({ statement, values: [] }));\r\n        }\r\n      })\r\n    );\r\n  }\r\n\r\n  async getProductById(id) {\r\n    const statement = `SELECT * FROM products LEFT JOIN vendors ON vendors.id=products.vendorid WHERE products.id=${id};`;\r\n    return (await CapacitorSQLite.query({ statement, values: [] })).values[0];\r\n  }\r\n\r\n  getDatabaseExport(mode) {\r\n    console.log('mode: ', mode);\r\n    return CapacitorSQLite.exportToJson({ jsonexportmode: mode });\r\n  }\r\n\r\n  addDummyProduct(name) {\r\n    const randomValue = Math.floor(Math.random() * 100) + 1;\r\n    const randomVendor = Math.floor(Math.random() * 3) + 1\r\n    const statement = `INSERT INTO products (name, currency, value, vendorid) VALUES ('${name}','EUR', ${randomValue}, ${randomVendor}), 'adquiriste este producto';`;\r\n    return CapacitorSQLite.execute({ statements: statement });\r\n  }\r\n\r\n  deleteProduct(productId) {\r\n    const statement = `DELETE FROM products WHERE id = ${productId};`;\r\n    return CapacitorSQLite.execute({ statements: statement });\r\n  }\r\n\r\n  // For testing only..\r\n  async deleteDatabase() {\r\n    const dbName = await Storage.get({ key: DB_NAME_KEY });\r\n    await Storage.set({ key: DB_SETUP_KEY, value: null });\r\n    return CapacitorSQLite.deleteDatabase({ database: dbName.value });\r\n  }\r\n\r\n\r\n}\r\n"],"sourceRoot":"webpack:///"}